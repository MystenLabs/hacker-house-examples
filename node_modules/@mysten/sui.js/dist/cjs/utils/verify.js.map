{
  "version": 3,
  "sources": ["../../../src/utils/verify.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { fromB64 } from '@mysten/bcs';\nimport { IntentScope } from '../cryptography/intent.js';\nimport { messageWithIntent } from '../cryptography/intent.js';\nimport type { SerializedSignature } from '../cryptography/signature.js';\nimport { blake2b } from '@noble/hashes/blake2b';\nimport { toSingleSignaturePubkeyPair } from '../cryptography/utils.js';\nimport { bcs } from '../bcs/index.js';\n\n// TODO: This might actually make sense to eventually move to the `Keypair` instances themselves, as\n// it could allow the Sui.js to be tree-shaken a little better, possibly allowing keypairs that are\n// not used (and their deps) to be entirely removed from the bundle.\n\n/** Verify data that is signed with the expected scope. */\nexport async function verifyMessage(\n\tmessage: Uint8Array | string,\n\tserializedSignature: SerializedSignature,\n\tscope: IntentScope,\n) {\n\tconst signature = toSingleSignaturePubkeyPair(serializedSignature);\n\n\tif (scope === IntentScope.PersonalMessage) {\n\t\tconst messageBytes = messageWithIntent(\n\t\t\tscope,\n\t\t\tbcs.ser(['vector', 'u8'], typeof message === 'string' ? fromB64(message) : message).toBytes(),\n\t\t);\n\n\t\tif (await signature.pubKey.verify(blake2b(messageBytes, { dkLen: 32 }), signature.signature)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Fallback for backwards compatibility, old versions of the SDK\n\t\t// did not properly wrap PersonalMessages in a PersonalMessage bcs Struct\n\t\tconst unwrappedMessageBytes = messageWithIntent(\n\t\t\tscope,\n\t\t\ttypeof message === 'string' ? fromB64(message) : message,\n\t\t);\n\n\t\treturn signature.pubKey.verify(\n\t\t\tblake2b(unwrappedMessageBytes, { dkLen: 32 }),\n\t\t\tsignature.signature,\n\t\t);\n\t}\n\n\tconst messageBytes = messageWithIntent(\n\t\tscope,\n\t\ttypeof message === 'string' ? fromB64(message) : message,\n\t);\n\n\treturn signature.pubKey.verify(blake2b(messageBytes, { dkLen: 32 }), signature.signature);\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,iBAAwB;AACxB,oBAA4B;AAC5B,IAAAA,iBAAkC;AAElC,qBAAwB;AACxB,mBAA4C;AAC5C,IAAAC,cAAoB;AAOpB,eAAsB,cACrB,SACA,qBACA,OACC;AACD,QAAM,gBAAY,0CAA4B,mBAAmB;AAEjE,MAAI,UAAU,0BAAY,iBAAiB;AAC1C,UAAMC,oBAAe;AAAA,MACpB;AAAA,MACA,gBAAI,IAAI,CAAC,UAAU,IAAI,GAAG,OAAO,YAAY,eAAW,oBAAQ,OAAO,IAAI,OAAO,EAAE,QAAQ;AAAA,IAC7F;AAEA,QAAI,MAAM,UAAU,OAAO,WAAO,wBAAQA,eAAc,EAAE,OAAO,GAAG,CAAC,GAAG,UAAU,SAAS,GAAG;AAC7F,aAAO;AAAA,IACR;AAIA,UAAM,4BAAwB;AAAA,MAC7B;AAAA,MACA,OAAO,YAAY,eAAW,oBAAQ,OAAO,IAAI;AAAA,IAClD;AAEA,WAAO,UAAU,OAAO;AAAA,UACvB,wBAAQ,uBAAuB,EAAE,OAAO,GAAG,CAAC;AAAA,MAC5C,UAAU;AAAA,IACX;AAAA,EACD;AAEA,QAAM,mBAAe;AAAA,IACpB;AAAA,IACA,OAAO,YAAY,eAAW,oBAAQ,OAAO,IAAI;AAAA,EAClD;AAEA,SAAO,UAAU,OAAO,WAAO,wBAAQ,cAAc,EAAE,OAAO,GAAG,CAAC,GAAG,UAAU,SAAS;AACzF;",
  "names": ["import_intent", "import_bcs", "messageBytes"]
}
